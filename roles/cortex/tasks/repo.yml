---
- name: Install Cortex repository
  yum:
    name: '{{ cortex_release_pkg }}'
    state: present
  become: yes
  tags: repo

- name: Check if Amazon Linux EPEL repository is enabled
  command:
    cmd: yum repolist enabled | grep -q amzn2extra-epel
    warn: no
  register: yum_repolist
  tags: repo

# This will NOT install the packages, but allow them to be installed via yum later
- name: Enable Amazon Linux EPEL repository
  command: amazon-linux-extras enable epel
  become: yes
  when: yum_repolist.rc != 0
  tags: repo

# This is not supported in the yum module
# https://github.com/ansible/ansible/pull/31450#issuecomment-352889579
- name: Clean and Update yum cache
  command:
    cmd: yum clean all && yum check-update
    warn: no
  become: yes
  when: yum_repolist.rc != 0
  tags: repo
